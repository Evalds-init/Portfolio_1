{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\Evalds\\\\Documents\\\\Portfolio_1\\\\client\\\\src\\\\context\\\\basket\\\\BasketState.js\";\nimport { GET_BASKET, DELETE_BASKET_ITEM, PROCESS_BASKET_PAYMENT, BASKET_ERROR, ADD_TO_BASKET, GET_BASKET_TOTAL, CHANGE_QUANTITY, CLEAR_BASKET_STATE, BASKET_PAYMENT_ERROR, CLEAR_ERRORS } from '../types';\nimport React, { useReducer } from 'react';\nimport BasketContext from './basketContext';\nimport basketReducer from './basketReducer';\nimport axios from 'axios';\naxios.defaults.withCredentials = true;\n\nconst BasketState = props => {\n  const initialState = {\n    basket: null,\n    total: 0,\n    basketError: null,\n    checkoutError: null,\n    loading: true\n  };\n  const [state, dispatch] = useReducer(basketReducer, initialState); //Get basket items\n\n  const getBasketItems = async () => {\n    try {\n      const res = await axios.get(`/api/v1/basket/getitems`);\n      dispatch({\n        type: GET_BASKET,\n        payload: res.data.data\n      });\n    } catch (error) {\n      dispatch({\n        type: BASKET_ERROR,\n        payload: error.response.data\n      });\n    }\n  }; //Get basket total\n\n\n  const getBasketTotal = (id, quantity) => {\n    const item = {\n      id,\n      quantity\n    };\n    dispatch({\n      type: GET_BASKET_TOTAL,\n      payload: item\n    });\n  }; //Change item quantity (client side only)\n\n\n  const changeItemQuantity = (id, quantity) => {\n    const item = {\n      id,\n      quantity\n    };\n    dispatch({\n      type: CHANGE_QUANTITY,\n      payload: item\n    });\n  }; //Delete item from basket\n\n\n  const deleteBasketItem = async id => {\n    try {\n      await axios.delete(`/api/v1/basket/deleteitem/${id}`);\n      dispatch({\n        type: DELETE_BASKET_ITEM,\n        payload: id\n      });\n    } catch (error) {\n      dispatch({\n        type: BASKET_ERROR,\n        payload: error.response.data\n      });\n    }\n  }; //Create order record after successful transaction\n\n\n  const clearBasketState = () => {\n    dispatch({\n      type: CLEAR_BASKET_STATE\n    });\n  }; //Create stripe checkout session\n\n\n  const acceptPayment = async (id, total, basket) => {\n    const data = {\n      total,\n      basket,\n      id\n    };\n    const config = {\n      headers: {\n        'Content-Type': 'application/json'\n      }\n    };\n\n    try {\n      const res = await axios.post('/api/v1/basket/checkout', data, config);\n      dispatch({\n        type: PROCESS_BASKET_PAYMENT,\n        payload: res.data.data\n      });\n    } catch (error) {\n      dispatch({\n        type: BASKET_PAYMENT_ERROR,\n        payload: error.response.data.error\n      });\n    }\n  }; //Add item to users' basket\n\n\n  const addToBasket = async (product, quantity) => {\n    let item = {\n      product: product._id,\n      quantity\n    };\n    const config = {\n      headers: {\n        'Content-Type': 'application/json'\n      }\n    };\n\n    try {\n      await axios.put(`/api/v1/basket/${product._id}/addtobasket`, item, config);\n      dispatch({\n        type: ADD_TO_BASKET,\n        payload: product\n      });\n    } catch (error) {\n      dispatch({\n        type: BASKET_ERROR,\n        payload: error.response.data\n      });\n    }\n  };\n\n  const clearErrors = () => {\n    setTimeout(() => dispatch({\n      type: CLEAR_ERRORS\n    }), 5000);\n  };\n\n  return /*#__PURE__*/React.createElement(BasketContext.Provider, {\n    value: {\n      basket: state.basket,\n      basketError: state.basketError,\n      loading: state.loading,\n      total: state.total,\n      checkoutError: state.checkoutError,\n      getBasketItems,\n      clearBasketState,\n      deleteBasketItem,\n      getBasketTotal,\n      addToBasket,\n      changeItemQuantity,\n      acceptPayment\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 121,\n      columnNumber: 5\n    }\n  }, props.children);\n};\n\nexport default BasketState;","map":{"version":3,"sources":["C:/Users/Evalds/Documents/Portfolio_1/client/src/context/basket/BasketState.js"],"names":["GET_BASKET","DELETE_BASKET_ITEM","PROCESS_BASKET_PAYMENT","BASKET_ERROR","ADD_TO_BASKET","GET_BASKET_TOTAL","CHANGE_QUANTITY","CLEAR_BASKET_STATE","BASKET_PAYMENT_ERROR","CLEAR_ERRORS","React","useReducer","BasketContext","basketReducer","axios","defaults","withCredentials","BasketState","props","initialState","basket","total","basketError","checkoutError","loading","state","dispatch","getBasketItems","res","get","type","payload","data","error","response","getBasketTotal","id","quantity","item","changeItemQuantity","deleteBasketItem","delete","clearBasketState","acceptPayment","config","headers","post","addToBasket","product","_id","put","clearErrors","setTimeout","children"],"mappings":";AAAA,SACEA,UADF,EAEEC,kBAFF,EAGEC,sBAHF,EAIEC,YAJF,EAKEC,aALF,EAMEC,gBANF,EAOEC,eAPF,EAQEC,kBARF,EASEC,oBATF,EAUEC,YAVF,QAWO,UAXP;AAYA,OAAOC,KAAP,IAAgBC,UAAhB,QAAkC,OAAlC;AACA,OAAOC,aAAP,MAA0B,iBAA1B;AACA,OAAOC,aAAP,MAA0B,iBAA1B;AACA,OAAOC,KAAP,MAAkB,OAAlB;AACAA,KAAK,CAACC,QAAN,CAAeC,eAAf,GAAiC,IAAjC;;AAEA,MAAMC,WAAW,GAAIC,KAAD,IAAW;AAC7B,QAAMC,YAAY,GAAG;AACnBC,IAAAA,MAAM,EAAE,IADW;AAEnBC,IAAAA,KAAK,EAAE,CAFY;AAGnBC,IAAAA,WAAW,EAAE,IAHM;AAInBC,IAAAA,aAAa,EAAE,IAJI;AAKnBC,IAAAA,OAAO,EAAE;AALU,GAArB;AAQA,QAAM,CAACC,KAAD,EAAQC,QAAR,IAAoBf,UAAU,CAACE,aAAD,EAAgBM,YAAhB,CAApC,CAT6B,CAW7B;;AACA,QAAMQ,cAAc,GAAG,YAAY;AACjC,QAAI;AACF,YAAMC,GAAG,GAAG,MAAMd,KAAK,CAACe,GAAN,CAAW,yBAAX,CAAlB;AAEAH,MAAAA,QAAQ,CAAC;AAAEI,QAAAA,IAAI,EAAE9B,UAAR;AAAoB+B,QAAAA,OAAO,EAAEH,GAAG,CAACI,IAAJ,CAASA;AAAtC,OAAD,CAAR;AACD,KAJD,CAIE,OAAOC,KAAP,EAAc;AACdP,MAAAA,QAAQ,CAAC;AAAEI,QAAAA,IAAI,EAAE3B,YAAR;AAAsB4B,QAAAA,OAAO,EAAEE,KAAK,CAACC,QAAN,CAAeF;AAA9C,OAAD,CAAR;AACD;AACF,GARD,CAZ6B,CAqB7B;;;AACA,QAAMG,cAAc,GAAG,CAACC,EAAD,EAAKC,QAAL,KAAkB;AACvC,UAAMC,IAAI,GAAG;AACXF,MAAAA,EADW;AAEXC,MAAAA;AAFW,KAAb;AAIAX,IAAAA,QAAQ,CAAC;AAAEI,MAAAA,IAAI,EAAEzB,gBAAR;AAA0B0B,MAAAA,OAAO,EAAEO;AAAnC,KAAD,CAAR;AACD,GAND,CAtB6B,CA6B7B;;;AACA,QAAMC,kBAAkB,GAAG,CAACH,EAAD,EAAKC,QAAL,KAAkB;AAC3C,UAAMC,IAAI,GAAG;AACXF,MAAAA,EADW;AAEXC,MAAAA;AAFW,KAAb;AAIAX,IAAAA,QAAQ,CAAC;AAAEI,MAAAA,IAAI,EAAExB,eAAR;AAAyByB,MAAAA,OAAO,EAAEO;AAAlC,KAAD,CAAR;AACD,GAND,CA9B6B,CAsC7B;;;AACA,QAAME,gBAAgB,GAAG,MAAOJ,EAAP,IAAc;AACrC,QAAI;AACF,YAAMtB,KAAK,CAAC2B,MAAN,CAAc,6BAA4BL,EAAG,EAA7C,CAAN;AACAV,MAAAA,QAAQ,CAAC;AAAEI,QAAAA,IAAI,EAAE7B,kBAAR;AAA4B8B,QAAAA,OAAO,EAAEK;AAArC,OAAD,CAAR;AACD,KAHD,CAGE,OAAOH,KAAP,EAAc;AACdP,MAAAA,QAAQ,CAAC;AAAEI,QAAAA,IAAI,EAAE3B,YAAR;AAAsB4B,QAAAA,OAAO,EAAEE,KAAK,CAACC,QAAN,CAAeF;AAA9C,OAAD,CAAR;AACD;AACF,GAPD,CAvC6B,CA+C7B;;;AACA,QAAMU,gBAAgB,GAAG,MAAM;AAC7BhB,IAAAA,QAAQ,CAAC;AAAEI,MAAAA,IAAI,EAAEvB;AAAR,KAAD,CAAR;AACD,GAFD,CAhD6B,CAmD7B;;;AACA,QAAMoC,aAAa,GAAG,OAAOP,EAAP,EAAWf,KAAX,EAAkBD,MAAlB,KAA6B;AACjD,UAAMY,IAAI,GAAG;AACXX,MAAAA,KADW;AAEXD,MAAAA,MAFW;AAGXgB,MAAAA;AAHW,KAAb;AAKA,UAAMQ,MAAM,GAAG;AACbC,MAAAA,OAAO,EAAE;AACP,wBAAgB;AADT;AADI,KAAf;;AAKA,QAAI;AACF,YAAMjB,GAAG,GAAG,MAAMd,KAAK,CAACgC,IAAN,CAAW,yBAAX,EAAsCd,IAAtC,EAA4CY,MAA5C,CAAlB;AACAlB,MAAAA,QAAQ,CAAC;AAAEI,QAAAA,IAAI,EAAE5B,sBAAR;AAAgC6B,QAAAA,OAAO,EAAEH,GAAG,CAACI,IAAJ,CAASA;AAAlD,OAAD,CAAR;AACD,KAHD,CAGE,OAAOC,KAAP,EAAc;AACdP,MAAAA,QAAQ,CAAC;AACPI,QAAAA,IAAI,EAAEtB,oBADC;AAEPuB,QAAAA,OAAO,EAAEE,KAAK,CAACC,QAAN,CAAeF,IAAf,CAAoBC;AAFtB,OAAD,CAAR;AAID;AACF,GApBD,CApD6B,CAyE7B;;;AACA,QAAMc,WAAW,GAAG,OAAOC,OAAP,EAAgBX,QAAhB,KAA6B;AAC/C,QAAIC,IAAI,GAAG;AACTU,MAAAA,OAAO,EAAEA,OAAO,CAACC,GADR;AAETZ,MAAAA;AAFS,KAAX;AAIA,UAAMO,MAAM,GAAG;AACbC,MAAAA,OAAO,EAAE;AACP,wBAAgB;AADT;AADI,KAAf;;AAMA,QAAI;AACF,YAAM/B,KAAK,CAACoC,GAAN,CACH,kBAAiBF,OAAO,CAACC,GAAI,cAD1B,EAEJX,IAFI,EAGJM,MAHI,CAAN;AAMAlB,MAAAA,QAAQ,CAAC;AAAEI,QAAAA,IAAI,EAAE1B,aAAR;AAAuB2B,QAAAA,OAAO,EAAEiB;AAAhC,OAAD,CAAR;AACD,KARD,CAQE,OAAOf,KAAP,EAAc;AACdP,MAAAA,QAAQ,CAAC;AAAEI,QAAAA,IAAI,EAAE3B,YAAR;AAAsB4B,QAAAA,OAAO,EAAEE,KAAK,CAACC,QAAN,CAAeF;AAA9C,OAAD,CAAR;AACD;AACF,GAtBD;;AAuBA,QAAMmB,WAAW,GAAG,MAAM;AACxBC,IAAAA,UAAU,CAAC,MAAM1B,QAAQ,CAAC;AAAEI,MAAAA,IAAI,EAAErB;AAAR,KAAD,CAAf,EAAyC,IAAzC,CAAV;AACD,GAFD;;AAIA,sBACE,oBAAC,aAAD,CAAe,QAAf;AACE,IAAA,KAAK,EAAE;AACLW,MAAAA,MAAM,EAAEK,KAAK,CAACL,MADT;AAELE,MAAAA,WAAW,EAAEG,KAAK,CAACH,WAFd;AAGLE,MAAAA,OAAO,EAAEC,KAAK,CAACD,OAHV;AAILH,MAAAA,KAAK,EAAEI,KAAK,CAACJ,KAJR;AAKLE,MAAAA,aAAa,EAAEE,KAAK,CAACF,aALhB;AAMLI,MAAAA,cANK;AAOLe,MAAAA,gBAPK;AAQLF,MAAAA,gBARK;AASLL,MAAAA,cATK;AAULY,MAAAA,WAVK;AAWLR,MAAAA,kBAXK;AAYLI,MAAAA;AAZK,KADT;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAgBGzB,KAAK,CAACmC,QAhBT,CADF;AAoBD,CAzHD;;AA2HA,eAAepC,WAAf","sourcesContent":["import {\r\n  GET_BASKET,\r\n  DELETE_BASKET_ITEM,\r\n  PROCESS_BASKET_PAYMENT,\r\n  BASKET_ERROR,\r\n  ADD_TO_BASKET,\r\n  GET_BASKET_TOTAL,\r\n  CHANGE_QUANTITY,\r\n  CLEAR_BASKET_STATE,\r\n  BASKET_PAYMENT_ERROR,\r\n  CLEAR_ERRORS,\r\n} from '../types';\r\nimport React, { useReducer } from 'react';\r\nimport BasketContext from './basketContext';\r\nimport basketReducer from './basketReducer';\r\nimport axios from 'axios';\r\naxios.defaults.withCredentials = true;\r\n\r\nconst BasketState = (props) => {\r\n  const initialState = {\r\n    basket: null,\r\n    total: 0,\r\n    basketError: null,\r\n    checkoutError: null,\r\n    loading: true,\r\n  };\r\n\r\n  const [state, dispatch] = useReducer(basketReducer, initialState);\r\n\r\n  //Get basket items\r\n  const getBasketItems = async () => {\r\n    try {\r\n      const res = await axios.get(`/api/v1/basket/getitems`);\r\n\r\n      dispatch({ type: GET_BASKET, payload: res.data.data });\r\n    } catch (error) {\r\n      dispatch({ type: BASKET_ERROR, payload: error.response.data });\r\n    }\r\n  };\r\n  //Get basket total\r\n  const getBasketTotal = (id, quantity) => {\r\n    const item = {\r\n      id,\r\n      quantity,\r\n    };\r\n    dispatch({ type: GET_BASKET_TOTAL, payload: item });\r\n  };\r\n  //Change item quantity (client side only)\r\n  const changeItemQuantity = (id, quantity) => {\r\n    const item = {\r\n      id,\r\n      quantity,\r\n    };\r\n    dispatch({ type: CHANGE_QUANTITY, payload: item });\r\n  };\r\n\r\n  //Delete item from basket\r\n  const deleteBasketItem = async (id) => {\r\n    try {\r\n      await axios.delete(`/api/v1/basket/deleteitem/${id}`);\r\n      dispatch({ type: DELETE_BASKET_ITEM, payload: id });\r\n    } catch (error) {\r\n      dispatch({ type: BASKET_ERROR, payload: error.response.data });\r\n    }\r\n  };\r\n  //Create order record after successful transaction\r\n  const clearBasketState = () => {\r\n    dispatch({ type: CLEAR_BASKET_STATE });\r\n  };\r\n  //Create stripe checkout session\r\n  const acceptPayment = async (id, total, basket) => {\r\n    const data = {\r\n      total,\r\n      basket,\r\n      id,\r\n    };\r\n    const config = {\r\n      headers: {\r\n        'Content-Type': 'application/json',\r\n      },\r\n    };\r\n    try {\r\n      const res = await axios.post('/api/v1/basket/checkout', data, config);\r\n      dispatch({ type: PROCESS_BASKET_PAYMENT, payload: res.data.data });\r\n    } catch (error) {\r\n      dispatch({\r\n        type: BASKET_PAYMENT_ERROR,\r\n        payload: error.response.data.error,\r\n      });\r\n    }\r\n  };\r\n  //Add item to users' basket\r\n  const addToBasket = async (product, quantity) => {\r\n    let item = {\r\n      product: product._id,\r\n      quantity,\r\n    };\r\n    const config = {\r\n      headers: {\r\n        'Content-Type': 'application/json',\r\n      },\r\n    };\r\n\r\n    try {\r\n      await axios.put(\r\n        `/api/v1/basket/${product._id}/addtobasket`,\r\n        item,\r\n        config\r\n      );\r\n\r\n      dispatch({ type: ADD_TO_BASKET, payload: product });\r\n    } catch (error) {\r\n      dispatch({ type: BASKET_ERROR, payload: error.response.data });\r\n    }\r\n  };\r\n  const clearErrors = () => {\r\n    setTimeout(() => dispatch({ type: CLEAR_ERRORS }), 5000);\r\n  };\r\n\r\n  return (\r\n    <BasketContext.Provider\r\n      value={{\r\n        basket: state.basket,\r\n        basketError: state.basketError,\r\n        loading: state.loading,\r\n        total: state.total,\r\n        checkoutError: state.checkoutError,\r\n        getBasketItems,\r\n        clearBasketState,\r\n        deleteBasketItem,\r\n        getBasketTotal,\r\n        addToBasket,\r\n        changeItemQuantity,\r\n        acceptPayment,\r\n      }}\r\n    >\r\n      {props.children}\r\n    </BasketContext.Provider>\r\n  );\r\n};\r\n\r\nexport default BasketState;\r\n"]},"metadata":{},"sourceType":"module"}